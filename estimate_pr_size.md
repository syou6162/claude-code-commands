# Pull Requestのサイズ見積もりと分割提案

指定されたタスクに対してPull Requestのサイズを見積もり、必要に応じて分割の提案を行います。

## 実行手順

1. **リポジトリの基本情報収集**
   - コードベースの構造分析（言語、フレームワーク、ディレクトリ構成）
   - 既存のテストとソースコードの比率分析

2. **過去のPull Request履歴分析**
   ```bash
   gh pr list --author @me --state merged --limit 20 --json number,title,additions,deletions,commits
   ```

3. **詳細なPull Request分析**
   - 直近10-20件のPull Requestについて、以下を分析：
     - 変更行数（追加・削除）
     - コミット数（レビュー対応の多さの指標）
     - 変更の性質（機械的変更 vs ロジック変更）

4. **作業量見積もり**
   - ソースコード変更予想行数
   - テスト追加予想行数（既存比率から算出）
   - ドキュメント更新予想行数
   - 設定ファイル・マイグレーション等の付随作業

5. **Pull Request分割アドバイス**
   - 500行以下：単一Pull Request推奨
   - 500-1000行：分割可能性検討
   - 1000行超：分割強く推奨
   - アーキテクチャ考慮した分割順序提案

## 分析ポイント

### 変更の性質分類
- **機械的変更**：一括置換、フォーマット調整、import整理等
  - ファイル数多くてもレビュー負荷低
- **ロジック変更**：新規実装、既存ロジック修正
  - 少ない行数でもレビュー負荷高

### 分割戦略
- **レイヤー別分割**：DB層 → API層 → UI層
- **段階別分割**：設定変更 → 実装 → テスト
- **依存関係考慮**：破壊的変更の分離、マイグレーション等

### リスク評価
- コミット数が多い過去Pull Request → レビュー対応が多い可能性
- 複雑なビジネスロジック変更 → 慎重な分割が必要
- 本番への影響度 → デプロイリスク考慮

## 出力形式

### 単一Pull Request推奨の場合
```
## 見積もり結果
- 予想ソースコード変更：XXX行
- 予想テスト追加：XXX行  
- 予想ドキュメント更新：XXX行
- **合計予想変更行数：XXX行**

## 分割提案
[500行以下/500-1000行/1000行超に応じた提案]

## 実装順序の提案
1. [第1段階の内容]
2. [第2段階の内容]
...
```

## 注意事項

- 過去のPull Request履歴から学習した傾向を活用
- リポジトリ固有のテスト・ドキュメント慣習を考慮
- レビュー負荷とデプロイリスクを総合的に判断