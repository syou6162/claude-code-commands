---
name: assembling-dev-team
description: 「開発チーム集合」「チームで実装」「チーム編成して」の言及時に使用。プランファイルに基づいて実装・コミット・レビューの3担当をスポーンし、ステップごとに実装→レビュー→コミットのサイクルを回す。
---

# 開発チーム集合

プランファイルに基づいて、実装・コミット・レビューのチームを編成し、ステップごとに実装→レビュー→コミットのサイクルを実行します。

## 禁止事項

<important>

- あなた（リーダー）は実装作業を行わない。タスク管理と調整のみ行う
- 一度に複数ステップを同時に実装させない。必ず1ステップずつ進める
- チームメンバーへの指示には、必ずプランファイルのパスと現在のステップ番号を含める
- チーム作成前にプランファイルの存在を確認する
- ユーザーの指示なしで勝手にチームを解散しない
- ユーザーに判断を仰ぐのは、メンバー間で意見が食い違うときや判断に迷うときのみ
- それ以外はリーダーが自律的に最後までタスクを進める

</important>

## 前提条件

<context name="prerequisites">

- `.claude_work/plans/*.md` に有効なプランファイルが1つ存在すること
- git worktree運用のため、単一のプランファイルが前提
- 環境変数 `CLAUDE_CODE_EXPERIMENTAL_AGENT_TEAMS=1` が設定済みであること

</context>

## チーム構成

| 役割 | 名前 | 目的 |
|------|------|------|
| リーダー（あなた） | - | タスク管理・全体調整・ステップ分解 |
| 実装担当 | implementer | プランの1ステップを実装 |
| コミット担当 | committer | 実装内容のセマンティックコミット、PR作成、CI監視 |
| レビュー担当 | reviewer | プランファイルに基づく簡易レビュー |
| プラン更新担当 | plan-updater | ユーザーの指摘をプランファイルに反映 |

各担当の詳細指示は references/ ディレクトリを参照:
- 実装担当: [references/implementer.md](references/implementer.md)
- コミット担当: [references/committer.md](references/committer.md)
- レビュー担当: [references/reviewer.md](references/reviewer.md)
- プラン更新担当: [references/plan-updater.md](references/plan-updater.md)

## 実行手順

<procedure>

### 手順1: プランファイルの特定

```bash
ls .claude_work/plans/*.md
```

プランファイルが存在しない場合はユーザーに報告して終了。

プランファイルのパスを以下のように定義:

<plan-file>

```
<取得したプランファイルのパス>
```

</plan-file>

### 手順2: プランファイルの分析

プランファイルを読み取り、実装ステップを分解する。
各ステップを TaskCreate でタスクリストに追加する。

### 手順3: チーム作成とメンバースポーン

1. TeamCreate でチームを作成（team_name: "dev-team-{セッションID短縮}"）

2. 以下の4名のチームメンバーをスポーン:

#### implementer のスポーンプロンプト

```
あなたは開発チームの実装担当です。

プランファイル: <plan-fileタグで定義されたパス>
詳細指示: まず skills/assembling-dev-team/references/implementer.md を Read ツールで読んでください。

そこに記載された手順に従って作業してください。
リーダーから各ステップの実装指示が来るまで待機してください。
作業完了後は必ずリーダーにメッセージで報告してください。
```

#### committer のスポーンプロンプト

```
あなたは開発チームのコミット担当です。

プランファイル: <plan-fileタグで定義されたパス>
詳細指示: まず skills/assembling-dev-team/references/committer.md を Read ツールで読んでください。

そこに記載された手順に従って作業してください。
リーダーからコミット指示が来るまで待機してください。
作業完了後は必ずリーダーにメッセージで報告してください。
```

#### reviewer のスポーンプロンプト

```
あなたは開発チームのレビュー担当です。

プランファイル: <plan-fileタグで定義されたパス>
詳細指示: まず skills/assembling-dev-team/references/reviewer.md を Read ツールで読んでください。

そこに記載された手順に従って作業してください。
リーダーからレビュー指示が来るまで待機してください。
レビュー結果は必ずリーダーにメッセージで報告してください。
```

#### plan-updater のスポーンプロンプト

```
あなたは開発チームのプラン更新担当です。

プランファイル: <plan-fileタグで定義されたパス>
詳細指示: まず skills/assembling-dev-team/references/plan-updater.md を Read ツールで読んでください。

そこに記載された手順に従って作業してください。
リーダーからプラン更新指示が来るまで待機してください。
作業完了後は必ずリーダーにメッセージで報告してください。
```

### 手順4: ステップごとの実装サイクル

各ステップについて以下のサイクルを実行:

#### 4.1 実装
- implementer にステップNの実装を依頼（SendMessage type: message）
  - プランファイルのパス + ステップ番号を含める
- TaskUpdate でタスクを in_progress に更新
- implementer からの完了報告を待つ

#### 4.2 レビューとコミット（並列実行）
- reviewer にステップNの実装レビューを依頼（SendMessage type: message）
  - プランファイルのパス + ステップ番号を含める
- committer にステップNのコミットを依頼（SendMessage type: message）
  - implementerの完了報告に含まれる変更ファイル一覧・概要を渡す
- 両方からの報告を待つ

#### 4.3 指摘への対応
- reviewer から指摘がある場合: implementer に修正を依頼 → 修正完了後に再レビュー
- 指摘がない場合: TaskUpdate でタスクを completed に更新

#### 4.4 次ステップへ
- 次のステップがあれば 4.1 に戻る
- 全ステップ完了なら手順5へ

### 手順5: PR作成とCI監視

1. committer に PR作成を依頼
2. committer にCI監視を依頼
3. CI失敗時:
   - committer からエラー報告を受け取る
   - implementer に修正を依頼
   - 修正後、committer にコミット→CI再監視を依頼
   - CI成功まで繰り返す（最大3回）
4. CI成功時: ユーザーに完了報告（PR URLを含む）

### 手順6: プラン変更時の対応

実装中に仕様が変わった場合:

1. リーダー（あなた）がプランファイルを修正
2. SendMessage type: broadcast で全メンバーに通知:
   ```
   プランファイルが更新されました。<plan-fileタグのパス>を再読み込みしてください。
   ```
3. 必要に応じてタスクリストも更新（TaskCreate / TaskUpdate）

### 手順7: チーム解散（ユーザー指示時のみ）

ユーザーから「解散」等の指示があった場合のみ:

1. 各メンバーに感想を求める（SendMessage type: message）
   - 今回の作業で感じたこと、改善点等
2. 全メンバーの感想が出揃うまで待つ
3. 各メンバーにシャットダウンリクエストを送信（SendMessage type: shutdown_request）
4. 全メンバーのシャットダウン確認を待つ
5. TeamDelete でチームリソースを削除
6. ユーザーに完了報告

<important>

全タスク完了後もチームは維持し、ユーザーの明示的な指示があるまで解散しないこと。

</important>

</procedure>

## チームメンバーへの指示フォーマット

### 実装依頼

```
implementer へ:

ステップ{N}の実装をお願いします。

プランファイル: <plan-fileタグのパス>
ステップ番号: {N}

プランファイルを読み取り、該当ステップの内容を実装してください。
完了したら報告してください。
```

### レビュー依頼

```
reviewer へ:

ステップ{N}の実装レビューをお願いします。

プランファイル: <plan-fileタグのパス>
ステップ番号: {N}

プランファイルを読み取り、該当ステップの実装が計画通りか確認してください。
指摘があれば具体的に報告してください。
```

### コミット依頼

```
committer へ:

ステップ{N}の実装をコミットしてください。

プランファイル: <plan-fileタグのパス>
ステップ番号: {N}

**implementerの報告内容**:
変更ファイル一覧:
{implementerの完了報告から変更ファイル一覧を転記}

概要:
{implementerの完了報告から概要を転記}

semantic-committing スキルを使用してコミットしてください。
コミット後のCI監視も含めて完了したら報告してください。
```
